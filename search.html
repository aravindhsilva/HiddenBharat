<script>
const city = new URLSearchParams(window.location.search).get("city");
const API = "https://aitraveldiscovery.aravindhsilva.workers.dev?city=" + city;

fetch(API)
  .then(res => res.json())
  .then(data => {
    const d = document.getElementById("list");
    d.innerHTML = "";

    if (data.error) {
      d.innerHTML = "Error: " + data.error;
      return;
    }

    if (!data.features || data.features.length === 0) {
      d.innerHTML = "No places found.";
      return;
    }

    data.features.forEach(p => {
      d.innerHTML += `
        <div class="card">
          <h3>${p.properties.name || "Unknown Place"}</h3>
          <button onclick="map(${p.geometry.coordinates[1]}, ${p.geometry.coordinates[0]})">
            Directions
          </button>
        </div>`;
    });
  })
  .catch(err => {
    document.getElementById("list").innerHTML =
      "Failed to load data. Check API.";
  });

function map(lat, lon) {
  window.open(
    "https://www.openstreetmap.org/?mlat=" + lat + "&mlon=" + lon,
    "_blank"
  );
}
</script>
